name: home
definition:
  # Wires connect to data in collections
  wires:
    leadcount:
      collection: uesio/crm.lead
      fields:
        uesio/core.id:
          function: COUNT
      groupby:
        uesio/core.createdat:
          function: DATE_TRUNC_DAY
      aggregate: true
      conditions:
        - field: uesio/core.createdat
          operator: IN
          value: THIS_WEEK
    opportunities:
      collection: uesio/crm.opportunity
      fields:
        uesio/crm.expected_revenue:
          function: SUM
      groupby:
        uesio/crm.close_date:
          function: DATE_TRUNC_MONTH
      aggregate: true
    newleads:
      collection: uesio/crm.lead
      fields:
        uesio/crm.firstname:
        uesio/crm.lastname:
        uesio/crm.email:
        uesio/crm.lead_rating:
        uesio/crm.initials:
        uesio/crm.source:
          fields:
            uesio/core.uniquekey:
      order:
        - field: uesio/core.createdat
          desc: true
    upcomingevents:
      collection: uesio/crm.event
      fields:
        uesio/crm.name:
        uesio/crm.description:
        uesio/crm.location:
        uesio/crm.starttime:
        uesio/crm.endtime:
        uesio/crm.initials:
      conditions:
        - field: uesio/crm.endtime
          operator: GTE
          value: NOW
      order:
        - field: uesio/crm.starttime
          desc: false
    upcomingtasks:
      collection: uesio/crm.task
      fields:
        uesio/crm.name:
        uesio/crm.description:
        uesio/crm.due_by:
        uesio/crm.initials:
        uesio/crm.is_completed:
        uesio/crm.is_overdue:
      conditions:
        - type: GROUP
          conjunction: OR
          conditions:
            - field: uesio/crm.due_by
              operator: GTE
              value: NOW
            - field: uesio/crm.is_completed
              operator: IS_BLANK
      order:
        - field: uesio/crm.due_by
          desc: false
  # Components determine the layout and composition of your view
  components:
    - uesio/io.viewlayout:
        left:
          - uesio/crm.nav:
        content:
          - uesio/io.box:
              uesio.variant: uesio/crm.dashboarditem
              components:
                - uesio/io.titlebar:
                    uesio.variant: uesio/crm.main
                    title: Hi $User{firstname}!
                    subtitle: Welcome to ues.io CRM.
                    avatar:
                      - uesio/io.text:
                          uesio.variant: uesio/io.icon
                          text: home
                - uesio/io.box:
                    uesio.variant: uesio/crm.scrollsection
                    components:
                      - uesio/io.grid:
                          uesio.variant: uesio/crm.two_columns
                          uesio.styleTokens:
                            root:
                              - lg:grid-rows-1
                          items:
                            - uesio/io.box:
                                uesio.variant: uesio/crm.dashboarditem
                                components:
                                  - uesio/io.titlebar:
                                      title: Upcoming Opportunities
                                      uesio.variant: uesio/crm.sub
                                  - uesio/io.linechart:
                                      uesio.variant: uesio/crm.main
                                      series:
                                        - name: revenue
                                          label: Expected Revenue
                                          valueField: uesio/crm.expected_revenue_sum
                                          categoryField: uesio/crm.close_date_date_trunc_month
                                          wire: opportunities
                                      labels:
                                        source: DATA
                                        timeunit: MONTH
                            - uesio/io.box:
                                uesio.variant: uesio/crm.dashboarditem
                                components:
                                  - uesio/io.titlebar:
                                      title: Leads This Week
                                      uesio.variant: uesio/crm.sub
                                  - uesio/io.barchart:
                                      uesio.variant: uesio/crm.main
                                      series:
                                        - name: leads
                                          label: New Leads
                                          valueField: uesio/core.id_count
                                          categoryField: uesio/core.createdat_date_trunc_day
                                          wire: leadcount
                                      labels:
                                        source: DATA
                                        timeunit: DAY
                                        timeunitfill: WEEK
                      - uesio/io.grid:
                          uesio.variant: uesio/crm.three_columns
                          uesio.styleTokens:
                            root:
                              - lg:grid-rows-1
                          items:
                            - uesio/io.box:
                                uesio.variant: uesio/crm.dashboarditem
                                components:
                                  - uesio/io.titlebar:
                                      title: New Leads
                                      uesio.variant: uesio/crm.sub
                                  - uesio/io.box:
                                      uesio.variant: uesio/crm.dashboardpanel
                                      components:
                                        - uesio/io.deck:
                                            wire: newleads
                                            mode: READ
                                            id: newleads
                                            uesio.variant: uesio/crm.tiles
                                            components:
                                              - uesio/io.tile:
                                                  uesio.variant: uesio/crm.item
                                                  content:
                                                    - uesio/io.titlebar:
                                                        uesio.variant: uesio/crm.item
                                                        title: ${firstname} ${lastname}
                                                        subtitle: ${email}
                                                        actions:
                                                          - uesio/io.text:
                                                              uesio.display:
                                                                - type: hasValue
                                                                  value: ${source->uesio/core.uniquekey}
                                                              uesio.styleTokens:
                                                                root:
                                                                  - bg-teal-500
                                                                  - text-white
                                                              uesio.variant: uesio/crm.badge
                                                              element: div
                                                              text: ${source->uesio/core.uniquekey}
                                                          - uesio/crm.stoplight:
                                                              field: lead_rating
                                                  avatar:
                                                    - uesio/io.avatar:
                                                        text: ${initials}
                                                  signals:
                                                    - signal: route/NAVIGATE_TO_ASSIGNMENT
                                                      collection: uesio/crm.lead
                                                      viewtype: detail
                                                      recordid: ${uesio/core.id}
                            - uesio/io.box:
                                uesio.variant: uesio/crm.dashboarditem
                                components:
                                  - uesio/io.titlebar:
                                      title: My Tasks
                                      uesio.variant: uesio/crm.sub
                                  - uesio/io.box:
                                      uesio.variant: uesio/crm.dashboardpanel
                                      components:
                                        - uesio/io.deck:
                                            wire: upcomingtasks
                                            mode: READ
                                            id: upcomingtasks
                                            uesio.variant: uesio/crm.tiles
                                            components:
                                              - uesio/io.tile:
                                                  uesio.variant: uesio/crm.item
                                                  content:
                                                    - uesio/io.titlebar:
                                                        uesio.variant: uesio/crm.item
                                                        title: ${name}
                                                        subtitle: $Date{due_by}
                                                  avatar:
                                                    - uesio/io.text:
                                                        uesio.display:
                                                          - type: hasNoValue
                                                            value: ${is_completed}
                                                          - type: hasNoValue
                                                            value: ${is_overdue}
                                                        uesio.variant: uesio/crm.avataricon
                                                        text: done
                                                    - uesio/io.text:
                                                        uesio.display:
                                                          - type: hasValue
                                                            value: ${is_completed}
                                                          - type: hasNoValue
                                                            value: ${is_overdue}
                                                        uesio.variant: uesio/crm.avataricon
                                                        text: done
                                                        uesio.styleTokens:
                                                          root:
                                                            - bg-green-600
                                                            - text-white
                                                    - uesio/io.text:
                                                        uesio.display:
                                                          - type: hasValue
                                                            value: ${is_overdue}
                                                        uesio.variant: uesio/crm.avatariconoutline
                                                        text: timer
                                                        uesio.styleTokens:
                                                          root:
                                                            - bg-rose-500
                                                            - text-white
                                                  signals:
                                                    - signal: route/NAVIGATE_TO_ASSIGNMENT
                                                      collection: uesio/crm.task
                                                      viewtype: detail
                                                      recordid: ${uesio/core.id}
                            - uesio/io.box:
                                uesio.variant: uesio/crm.dashboarditem
                                components:
                                  - uesio/io.titlebar:
                                      title: My Events
                                      uesio.variant: uesio/crm.sub
                                  - uesio/io.box:
                                      uesio.variant: uesio/crm.dashboardpanel
                                      components:
                                        - uesio/io.deck:
                                            wire: upcomingevents
                                            mode: READ
                                            id: upcomingevents
                                            uesio.variant: uesio/crm.tiles
                                            components:
                                              - uesio/io.tile:
                                                  uesio.variant: uesio/crm.item
                                                  content:
                                                    - uesio/io.titlebar:
                                                        uesio.variant: uesio/crm.item
                                                        title: ${name}
                                                        subtitle: $Date{starttime}
                                                  avatar:
                                                    - uesio/io.text:
                                                        uesio.variant: uesio/crm.avatariconoutline
                                                        text: calendar_month
                                                  signals:
                                                    - signal: route/NAVIGATE_TO_ASSIGNMENT
                                                      collection: uesio/crm.event
                                                      viewtype: detail
                                                      recordid: ${uesio/core.id}
